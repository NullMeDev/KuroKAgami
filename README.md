# Privacy Deals Bot

A zero-cost, fully serverless Discord bot that scrapes public privacy & tech coupon and deal sources (HTML pages, RSS feeds, Reddit subreddits), deduplicates & scores â€œhotâ€ deals, and posts color-coded embeds into your Discord channel on a schedule.

It also provides local development utilities (Makefile, Dockerfile), CI/CD via GitHub Actions, and an always-present fallback embed when no new deals are detected.

---

## ğŸ” Features

- **Multi-source scraping**  
  - **HTML pages** using CSS selectors  
  - **RSS feeds** via `feedparser`  
  - **Reddit** `/r/*/new.json` endpoints  

- **De-duplication & TTL**  
  - SQLite (`data/deals.sqlite`) tracks seen items by fuzzy title signature  
  - Per-source Time-To-Live (days) to re-post expired deals  

- **Hot-deal scoring**  
  - Regex percentage detection (`50%`, `100%`, etc.)  
  - Configurable minimum â€œhotâ€ threshold  

- **Discord embeds**  
  - Customizable colors per category (via YAML)  
  - â€œNo Waifus For You Weebâ€ placeholder when no new deals  
  - Top-5 fallback embed if no new deals  

- **JSON metrics**  
  - Writes `metrics.json` for CI steps or alerts  
  - Contains total scraped, fresh deals list, error map  

- **Local dev & CI**  
  - **Makefile** for `deps`, `test`, `run`, `dry-run`, `lint`  
  - **Dockerfile** for containerized runs  
  - **GitHub Actions** workflow to run every 3 hours, with manual dispatch  

---

## ğŸ“ Repository Layout

```
/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deal_feed.yml      # CI: scrape & post on schedule
â”œâ”€â”€ config/
â”‚   â””â”€â”€ sources.yaml           # Sources, categories, colors, version
â”œâ”€â”€ data/
â”‚   â””â”€â”€ deals.sqlite           # SQLite DB (created at runtime)
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_selectors.py      # Parser/selector smoke-tests
â”œâ”€â”€ Dockerfile                 # Build container image
â”œâ”€â”€ Makefile                   # Local commands
â”œâ”€â”€ README.md                  # This file
â”œâ”€â”€ main.py                    # Bot entrypoint & scraper logic
â”œâ”€â”€ requirements.txt           # Python dependencies
â””â”€â”€ metrics.json               # Generated by main.py (CI output)
```

---

## âš™ï¸ Configuration

1. **Discord Webhook(s)**  
   Set one or more webhook URLs in your environment:

   ```bash
   export DISCORD_WEBHOOKS="https://discord.com/api/â€¦"
   ```

2. **Source & Color YAML**  
   Edit `config/sources.yaml`:

   ```yaml
   version: 1.2.0

   colors:
     default: 15844367   # light purple
     vpn:     3447003    # dark blue
     # â€¦etcâ€¦

   reddit:
     - vpndeals
     - vpncoupons
     # â€¦

   html:
     - name: GrabOn VPN
       url: https://www.grabon.in/vpn-coupons/
       selector: .offer-box
     # â€¦

   rss:
     - name: Hugging Face RSS
       url: https://huggingface.co/feed
       selector: entry
     # â€¦
   ```

---

## ğŸš€ Quick Start (Local)

```bash
# Install dependencies
make deps

# Run tests
make test

# Dry-run parse only
make dry-run

# Run & post to Discord
make run

# Lint code
make lint
```

---

## ğŸ³ Docker

```bash
docker build -t privacy-deals-bot .
docker run   --env DISCORD_WEBHOOKS="https://discord.com/api/â€¦"   privacy-deals-bot
```

---

## ğŸ“ˆ CI/CD (GitHub Actions)

- Workflow: `.github/workflows/deal_feed.yml`  
- Schedule: every 3 hours + manual dispatch  
- Steps: checkout, install, test, scrape, post, cache  

---

## ğŸ¤ Contributing

1. Fork the repo  
2. Create a topic branch  
3. Make your changes & tests  
4. Open a Pull Request  

---

## ğŸ“ License

This project is licensed under MIT. See [LICENSE](LICENSE).
