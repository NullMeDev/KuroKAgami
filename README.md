# Privacy Deals Bot

A zero-cost, fully serverless Discord bot that scrapes public privacy & tech coupon and deal sources (HTML pages, RSS feeds, Reddit subreddits), deduplicates & scores “hot” deals, and posts color-coded embeds into your Discord channel on a schedule.

It also provides local development utilities (Makefile, Dockerfile), CI/CD via GitHub Actions, and an always-present fallback embed when no new deals are detected.

---

## 🔍 Features

- **Multi-source scraping**  
  - **HTML pages** using CSS selectors  
  - **RSS feeds** via `feedparser`  
  - **Reddit** `/r/*/new.json` endpoints  

- **De-duplication & TTL**  
  - SQLite (`data/deals.sqlite`) tracks seen items by fuzzy title signature  
  - Per-source Time-To-Live (days) to re-post expired deals  

- **Hot-deal scoring**  
  - Regex percentage detection (`50%`, `100%`, etc.)  
  - Configurable minimum “hot” threshold  

- **Discord embeds**  
  - Customizable colors per category (via YAML)  
  - “No Waifus For You Weeb” placeholder when no new deals  
  - Top-5 fallback embed if no new deals  

- **JSON metrics**  
  - Writes `metrics.json` for CI steps or alerts  
  - Contains total scraped, fresh deals list, error map  

- **Local dev & CI**  
  - **Makefile** for `deps`, `test`, `run`, `dry-run`, `lint`  
  - **Dockerfile** for containerized runs  
  - **GitHub Actions** workflow to run every 3 hours, with manual dispatch  

---

## 📁 Repository Layout

```
/
├── .github/
│   └── workflows/
│       └── deal_feed.yml      # CI: scrape & post on schedule
├── config/
│   └── sources.yaml           # Sources, categories, colors, version
├── data/
│   └── deals.sqlite           # SQLite DB (created at runtime)
├── tests/
│   └── test_selectors.py      # Parser/selector smoke-tests
├── Dockerfile                 # Build container image
├── Makefile                   # Local commands
├── README.md                  # This file
├── main.py                    # Bot entrypoint & scraper logic
├── requirements.txt           # Python dependencies
└── metrics.json               # Generated by main.py (CI output)
```

---

## ⚙️ Configuration

1. **Discord Webhook(s)**  
   Set one or more webhook URLs in your environment:

   ```bash
   export DISCORD_WEBHOOKS="https://discord.com/api/…"
   ```

2. **Source & Color YAML**  
   Edit `config/sources.yaml`:

   ```yaml
   version: 1.2.0

   colors:
     default: 15844367   # light purple
     vpn:     3447003    # dark blue
     # …etc…

   reddit:
     - vpndeals
     - vpncoupons
     # …

   html:
     - name: GrabOn VPN
       url: https://www.grabon.in/vpn-coupons/
       selector: .offer-box
     # …

   rss:
     - name: Hugging Face RSS
       url: https://huggingface.co/feed
       selector: entry
     # …
   ```

---

## 🚀 Quick Start (Local)

```bash
# Install dependencies
make deps

# Run tests
make test

# Dry-run parse only
make dry-run

# Run & post to Discord
make run

# Lint code
make lint
```

---

## 🐳 Docker

```bash
docker build -t privacy-deals-bot .
docker run   --env DISCORD_WEBHOOKS="https://discord.com/api/…"   privacy-deals-bot
```

---

## 📈 CI/CD (GitHub Actions)

- Workflow: `.github/workflows/deal_feed.yml`  
- Schedule: every 3 hours + manual dispatch  
- Steps: checkout, install, test, scrape, post, cache  

---

## 🤝 Contributing

1. Fork the repo  
2. Create a topic branch  
3. Make your changes & tests  
4. Open a Pull Request  

---

## 📝 License

This project is licensed under MIT. See [LICENSE](LICENSE).
